# Raffle System - Visual Overview

## System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RAFFLE SYSTEM FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER EARNS POINTS
    â†“
    â””â†’ Completes articles/sections
    â””â†’ Accumulates points in their profile

ADMIN INITIALIZES RAFFLE (First time)
    â†“
    â””â†’ Prize pool created:
       â€¢ 1x iPad
       â€¢ 1x JBL Headphones
       â€¢ 10x $10 Gift Cards

ADMIN VIEWS ENTRIES (Optional)
    â†“
    â””â†’ See all eligible users (100+ points)
    â””â†’ See their entry counts
    â””â†’ Understand the odds

ADMIN ROLLS RAFFLE
    â†“
    â””â†’ System calculates user entries:
       (1 entry per 100 points)
    â”œâ†’ John: 350 pts = 3 entries â”â”â”â”“
    â”œâ†’ Sarah: 200 pts = 2 entries â”â”â•‹â†’ Weighted Random Draw
    â”œâ†’ Mike: 100 pts = 1 entry â”â”â”â”â”â”›
    â”œâ†’ ... (all eligible users)
    â”‚
    â””â†’ Select winners one at a time
       â”œâ†’ Prize #1 â†’ Random winner from pool
       â”œâ†’ Prize #2 â†’ Random winner from pool
       â””â†’ ... (continue for all 12 prizes)

RESULTS STORED & DISPLAYED
    â†“
    â”œâ†’ Firebase: aggregate/raffle
    â””â†’ UI: Shows all winners with details
```

## Directory Structure

```
src/app/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ raffleService.ts ................. Backend logic
â”‚   â”œâ”€â”€ userService.ts ................... User data
â”‚   â””â”€â”€ (other services)
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ raffle/
â”‚   â”‚   â””â”€â”€ page.tsx .................... Admin UI
â”‚   â”œâ”€â”€ stats/
â”‚   â”‚   â””â”€â”€ page.tsx .................... Stats page
â”‚   â””â”€â”€ content/
â”‚       â””â”€â”€ page.tsx .................... Content page
â”œâ”€â”€ me/
â”‚   â”œâ”€â”€ me-nav.tsx ...................... Navigation (UPDATED)
â”‚   â””â”€â”€ page.tsx ........................ Dashboard
â””â”€â”€ firebase/
    â””â”€â”€ config.ts ....................... Firebase setup
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        /admin/raffle/page.tsx           â”‚
â”‚      (Client Component - Admin UI)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Queries   â”‚  â”‚   Mutations     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ getRaffles  â”‚  â”‚ initMutation    â”‚
    â”‚ getConfig   â”‚  â”‚ rollMutation    â”‚
    â”‚ getEntries  â”‚  â”‚ resetMutation   â”‚
    â”‚ getResults  â”‚  â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   raffleService.ts           â”‚
    â”‚   (Service Layer)            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Firebase Firestore         â”‚
    â”‚   â€¢ aggregate/raffle         â”‚
    â”‚   â€¢ users/*/scores           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Models

```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Prize                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: string                          â”‚
â”‚ name: string                        â”‚
â”‚ quantity: number                    â”‚
â”‚ description: string                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        RaffleEntry                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uid: string                         â”‚
â”‚ displayName: string                 â”‚
â”‚ email: string                       â”‚
â”‚ points: number                      â”‚
â”‚ entries: number (points / 100)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       RaffleResult                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ prizeId: string                     â”‚
â”‚ prizeName: string                   â”‚
â”‚ winnerUid: string                   â”‚
â”‚ winnerName: string                  â”‚
â”‚ winnerEmail: string                 â”‚
â”‚ timestamp: Timestamp                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      RaffleConfig                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pointsPerEntry: 100                  â”‚
â”‚ prizes: Prize[]                      â”‚
â”‚ results: RaffleResult[]              â”‚
â”‚ active: boolean                      â”‚
â”‚ createdAt: Timestamp                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI Sections

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Raffle Manager - Admin Page                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âš ï¸  Raffle System Information                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚ ğŸ† PRIZE POOL                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â€¢ Apple iPad (A16)        Ã—1                   â”‚  â”‚
â”‚ â”‚ â€¢ JBL Tune 720BT          Ã—1                   â”‚  â”‚
â”‚ â”‚ â€¢ $10 Amazon Giftcard     Ã—10                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚ â„¹ï¸  RAFFLE INFO                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Points per entry: 100                          â”‚  â”‚
â”‚ â”‚ Status: ACTIVE / COMPLETED                     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚ [Initialize Raffle] [Roll Raffle] [Reset Raffle]   â”‚
â”‚                                                      â”‚
â”‚ ENTRY DETAILS (Optional)                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ John Doe          350 pts  â†’ 3 entries         â”‚  â”‚
â”‚ â”‚ sarah@school.com  200 pts  â†’ 2 entries         â”‚  â”‚
â”‚ â”‚ Mike Smith        150 pts  â†’ 1 entry           â”‚  â”‚
â”‚ â”‚ ...                                             â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚ ğŸ‰ RAFFLE RESULTS                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âœ“ Apple iPad - John Doe (john@school.com)     â”‚  â”‚
â”‚ â”‚   Won at: Dec 14, 2024, 2:30 PM               â”‚  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â”‚ âœ“ JBL Tune 720BT - Sarah Chen (sarah@...)     â”‚  â”‚
â”‚ â”‚   Won at: Dec 14, 2024, 2:30 PM               â”‚  â”‚
â”‚ â”‚                                                â”‚  â”‚
â”‚ â”‚ âœ“ $10 Amazon - Mike Smith (mike@school.com)   â”‚  â”‚
â”‚ â”‚   Won at: Dec 14, 2024, 2:30 PM               â”‚  â”‚
â”‚ â”‚ ... (9 more giftcard winners)                  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Navigation Path

```
Homepage (/)
    â†“
Login â†’ Dashboard (/me)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Panel     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Statistics    â”‚  /admin/stats
â”‚ â€¢ Content       â”‚  /admin/content
â”‚ â€¢ Raffle        â”‚  /admin/raffle  â† YOU ARE HERE
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Weighted Selection Algorithm

```
Pool: [User1, User1, User1, User2, User2, User3]
      (3 entries)        (2 entries)    (1 entry)
        â†“           â†“       â†“       â†“      â†“

Total size: 6

Draw 1: Random(0-5) = 2 â†’ User1 wins Prize 1 âœ“
        Remove winner â†’ [User1, User1, User2, User2, User3]

Draw 2: Random(0-4) = 3 â†’ User2 wins Prize 2 âœ“
        Remove winner â†’ [User1, User1, User2, User3]

Draw 3: Random(0-3) = 0 â†’ User1 wins Prize 3 âœ“
        ... continue for all 12 prizes
```

## Probability Example

```
4 Users, 12 prizes:
â”œâ”€ John: 400 pts = 4 entries (40% chance per draw)
â”œâ”€ Sarah: 300 pts = 3 entries (30% chance per draw)
â”œâ”€ Mike: 200 pts = 2 entries (20% chance per draw)
â””â”€ Lisa: 100 pts = 1 entry (10% chance per draw)

Total: 10 entries

John's odds for each prize:
4 entries / 10 total = 40% chance to win any given prize

Sarah's odds for each prize:
3 entries / 10 total = 30% chance to win any given prize
```

## Key Features

âœ… **Weighted Random Selection** - Better odds for users with more points
âœ… **Transparent Entry System** - 1 entry per 100 points
âœ… **Real User Data** - Pulls actual user points from database
âœ… **Persistent Results** - Saves to Firebase Firestore
âœ… **Admin Oversight** - Can view all participants and their odds
âœ… **Detailed Reporting** - Shows winner names, emails, and timestamps
âœ… **Resettable** - Can run multiple raffles

## Security

- **Admin-only access** - Verified via `profile.admin` check
- **Firebase Firestore rules** - Admin can read/write to raffle data
- **User data protection** - Only displays names and emails (no passwords/sensitive data)
- **Audit trail** - All results timestamped and stored
